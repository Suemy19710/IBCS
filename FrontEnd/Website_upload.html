<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title> Jugo - AI tool </title>
  <link rel="icon" href="J-icon.png">

  <style>
    :root{
      --bg:#ffffff;
      --accent:#ff8c00;
      --accent-2:#13196B;
      --muted:#555;
      --glass:rgba(0,0,0,0.05);
      --radius:14px;
      --max-width:1100px;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    }

    body{
      margin:0;
      background:#ffffff;
      color:#13196B;
    }

    a{color:var(--accent-2); text-decoration:none}
    img{display:block; max-width:100%}

    .container{
      max-width:var(--max-width);
      margin:0 auto;
      padding:30px 20px;
    }

    header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:8px 0;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:14px;
    }

    .logo img{
      width:180px;
      height:auto;
    }

    nav{
      display:flex;
      gap:14px;
      font-weight:600;
    }

    nav a{
      padding:8px 12px;
      border-radius:8px;
      color:#13196B;
    }

    nav a:hover{
      background:var(--glass);
    }

    /* Upload Box */
    .upload-box{
      margin:60px auto 0;
      max-width:600px;
      background:#f6f7fb;
      border:2px dashed #13196B;
      padding:40px;
      text-align:center;
      border-radius:var(--radius);
    }

    .upload-box h2{
      margin-top:0;
      margin-bottom:20px;
      font-size:26px;
      color:#13196B;
    }

    .drop-zone {
      border: 2px dashed var(--accent-2);
      background: #ffffff;
      padding: 40px;
      border-radius: 14px;
      cursor: pointer;
      color: var(--accent-2);
      margin-bottom: 20px;
      transition: 0.25s;
    }

    .drop-zone.dragover {
      background: #eaf0ff;
      border-color: var(--accent);
    }

    .btn-upload, .btn-photo{
      margin-top:15px;
      padding:12px 24px;
      background:var(--accent);
      color:white;
      border:none;
      border-radius:10px;
      font-weight:700;
      cursor:pointer;
      font-size:16px;
    }

    .btn-upload:hover, .btn-photo:hover{
      opacity:0.9;
    }

    #fileName {
      margin-top: 10px;
      font-size: 14px;
      color: #555;
    }

    #cameraPreview {
      display: none;
      margin-top: 20px;
      width: 100%;
      border-radius: 10px;
    }
  </style>
</head>

<body>

<div class="container">
  
  <!-- Header -->
  <header>
    <div class="brand">
        <a href="Website_homepage.html" class="logo">
            <img src="Logo_xmas.png" alt="Jugo logo">
        </a>
    </div>

    <nav>
      <a href="Website_homepage.html">Home</a>
      <a href="#home">Tool</a>
      <a href="Website_feedback.html">Feedback</a>
    </nav>
  </header>

  <!-- Upload Section -->
<div class="upload-box">
  <h2>Upload Your Dashboard</h2>


  <!-- Drag & Drop Zone -->
  <div id="dropZone" class="drop-zone">
      <p>Click or Drag & Drop your dashboard image here</p>
  </div>

  <!-- Hidden click-to-upload input -->
  <input type="file" id="fileInput" accept="image/*" style="display:none;">

  <!-- File name preview -->
  <div id="fileName"></div>

  <!-- TAKE PHOTO BUTTON -->
  <button class="btn-photo" onclick="openCamera()">Take Photo</button>

  <!-- Hidden camera preview -->
  <video id="cameraPreview" autoplay></video>

  <button class="btn-upload" onclick="uploadFile()">Upload</button>

</div>

<script>
const dropZone = document.getElementById("dropZone");
const cameraPreview = document.getElementById("cameraPreview");
const fileInput = document.getElementById("fileInput");
const fileNameDisplay = document.getElementById("fileName");

let cameraStream = null;
let selectedFile = null;

/* -------------------------------------------------------
   CLICK TO OPEN FILE PICKER
------------------------------------------------------- */
dropZone.addEventListener("click", () => {
  fileInput.click();
});

/* -------------------------------------------------------
   FILE PICKER IMAGE SELECTED
------------------------------------------------------- */
fileInput.addEventListener("change", () => {
  if (fileInput.files.length > 0) {
    selectedFile = fileInput.files[0];
    fileNameDisplay.textContent = selectedFile.name;
  }
});

/* -------------------------------------------------------
   DRAG & DROP
------------------------------------------------------- */
dropZone.addEventListener("dragover", (e) => {
    e.preventDefault();
    dropZone.classList.add("dragover");
});

dropZone.addEventListener("dragleave", () => {
    dropZone.classList.remove("dragover");
});

dropZone.addEventListener("drop", (e) => {
    e.preventDefault();
    dropZone.classList.remove("dragover");

    const file = e.dataTransfer.files[0];
    if (!file || !file.type.startsWith("image/")) {
        alert("Please drop a valid image file.");
        return;
    }

    selectedFile = file;
    fileNameDisplay.textContent = file.name;
});

/* -------------------------------------------------------
   CAMERA MODE
------------------------------------------------------- */
async function openCamera() {
    try {
        cameraStream = await navigator.mediaDevices.getUserMedia({
            video: { facingMode: "environment" }
        });

        cameraPreview.srcObject = cameraStream;
        cameraPreview.style.display = "block";

        document.querySelector(".btn-photo").innerText = "Capture Photo";
        document.querySelector(".btn-photo").onclick = capturePhoto;

    } catch (err) {
        alert("Camera not available.");
    }
}

function capturePhoto() {
    const video = cameraPreview;
    const canvas = document.createElement("canvas");

    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;

    const ctx = canvas.getContext("2d");
    ctx.drawImage(video, 0, 0);

    const dataURL = canvas.toDataURL("image/png");

    cameraStream.getTracks().forEach(t => t.stop());
    cameraPreview.style.display = "none";

    sessionStorage.setItem("uploadedImage", dataURL);

    window.location.href = "Website_feedback.html";
}

/* -------------------------------------------------------
   UPLOAD BUTTON
------------------------------------------------------- */
// function uploadFile() {
//     if (!selectedFile) {
//         alert("Please select or drop an image first.");
//         return;
//     }

//     const reader = new FileReader();
//     reader.onload = function(e) {
//         sessionStorage.setItem("uploadedImage", e.target.result);
//         window.location.href = "Website_feedback.html";
//     };

//     reader.readAsDataURL(selectedFile);
// }

async function uploadFile() {
  if (!selectedFile) {
    alert("Please select or capture an image first.");
    return;
  }

  // Save image preview
  const reader = new FileReader();
  reader.onload = e => sessionStorage.setItem("uploadedImage", e.target.result);
  reader.readAsDataURL(selectedFile);

  // Send to FastAPI
  const formData = new FormData();
  formData.append("file", selectedFile);

  try {
    const res = await fetch("http://localhost:8000/api/predict", {
      method: "POST",
      body: formData
    });

    if (!res.ok) {
      statusBox.textContent = "Server error.";
      return;
    }

    const data = await res.json();

    sessionStorage.setItem("modelResult", JSON.stringify(data));

    window.location.href = "Website_feedback.html";

  } catch (err) {
    console.error(err);
  }
}
</script>

</body>
</html>
