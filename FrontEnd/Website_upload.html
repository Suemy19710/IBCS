<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title> Jugo - AI tool </title>
  <link rel="icon" href="J-icon.png">

  <style>
    :root{
      --bg:#ffffff;
      --accent:#ff8c00;
      --accent-2:#13196B;
      --muted:#555;
      --glass:rgba(0,0,0,0.05);
      --radius:14px;
      --max-width:1100px;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    }

    body{
      margin:0;
      background:#ffffff;
      color:#13196B;
    }

    a{color:var(--accent-2); text-decoration:none}
    img{display:block; max-width:100%}

    .container{
      max-width:var(--max-width);
      margin:0 auto;
      padding:30px 20px;
    }

    header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:8px 0;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:14px;
    }

    .logo img{
      width:180px;
      height:auto;
    }

    nav{
      display:flex;
      gap:14px;
      font-weight:600;
    }

    nav a{
      padding:8px 12px;
      border-radius:8px;
      color:#13196B;
    }

    nav a:hover{
      background:var(--glass);
    }

    /* Upload Box */
    .upload-box{
      margin:60px auto 0;
      max-width:600px;
      background:#f6f7fb;
      border:2px dashed #13196B;
      padding:40px;
      text-align:center;
      border-radius:var(--radius);
    }

    .upload-box h2{
      margin-top:0;
      margin-bottom:20px;
      font-size:26px;
      color:#13196B;
    }

    .drop-zone {
      border: 2px dashed var(--accent-2);
      background: #ffffff;
      padding: 40px;
      border-radius: 14px;
      cursor: pointer;
      color: var(--accent-2);
      margin-bottom: 20px;
      transition: 0.25s;
    }

    .drop-zone.dragover {
      background: #eaf0ff;
      border-color: var(--accent);
    }

    .btn-upload, .btn-photo{
      margin-top:15px;
      padding:12px 24px;
      background:var(--accent);
      color:white;
      border:none;
      border-radius:10px;
      font-weight:700;
      cursor:pointer;
      font-size:16px;
    }

    .btn-upload:hover, .btn-photo:hover{
      opacity:0.9;
    }

    #fileName {
      margin-top: 10px;
      font-size: 14px;
      color: #555;
    }
  </style>
</head>

<body>

<div class="container">
  
  <!-- Header -->
  <header>
    <div class="brand">
        <a href="Website_homepage.html" class="logo">
            <img src="Logo_xmas.png" alt="Jugo logo">
        </a>
    </div>

    <nav>
      <a href="Website_homepage.html">Home</a>
      <a href="#home">Tool</a>
      <!--<a href="Website_feedback.html">Result</a>-->
    </nav>
  </header>

  <!-- Upload Section -->
  <div class="upload-box">
    <h2>Upload Your Dashboard</h2>

    <div id="dropZone" class="drop-zone">
      <p>Click or Drag & Drop your dashboard image here</p>
    </div>

    <!-- Normal file picker (gallery / files) -->
    <input type="file" id="fileInput" accept="image/*" style="display:none;">

    <!-- Camera-only input for phones -->
    <input type="file" id="cameraInput" accept="image/*" capture="environment" style="display:none;">

    <div id="fileName"></div>

    <button class="btn-photo" onclick="openCamera()">Take Photo</button>

    <button class="btn-upload" onclick="uploadFile()">Upload</button>
  </div>
</div>

<script>
  const dropZone = document.getElementById("dropZone");
const fileInput = document.getElementById("fileInput");
const cameraInput = document.getElementById("cameraInput");
const fileNameDisplay = document.getElementById("fileName");

let selectedFile = null;

/* CLICK TO OPEN FILE PICKER */
dropZone.addEventListener("click", () => {
  fileInput.click();
});

/* FILE PICKER (gallery / files) */
fileInput.addEventListener("change", () => {
  if (fileInput.files.length > 0) {
    selectedFile = fileInput.files[0];
    fileNameDisplay.textContent = selectedFile.name;
  }
});

/* DRAG & DROP */
dropZone.addEventListener("dragover", (e) => {
  e.preventDefault();
  dropZone.classList.add("dragover");
});

dropZone.addEventListener("dragleave", () => {
  dropZone.classList.remove("dragover");
});

dropZone.addEventListener("drop", (e) => {
  e.preventDefault();
  dropZone.classList.remove("dragover");

  const file = e.dataTransfer.files[0];
  if (!file || !file.type.startsWith("image/")) {
    alert("Please drop a valid image file.");
    return;
  }

  selectedFile = file;
  fileNameDisplay.textContent = file.name;
});

/* CAMERA MODE (native capture on phone) */
function openCamera() {
  cameraInput.click();
}

/* When a photo is taken via cameraInput */
cameraInput.addEventListener("change", () => {
  if (cameraInput.files.length > 0) {
    selectedFile = cameraInput.files[0];
    fileNameDisplay.textContent = selectedFile.name || "Photo captured";
  }
});

/* UPLOAD BUTTON: camera + API + redirect */
async function uploadFile() {
  if (!selectedFile) {
    alert("Please select or capture an image first.");
    return;
  }

  // Show loading state
  const uploadBtn = document.querySelector('.btn-upload');
  const originalText = uploadBtn.textContent;
  uploadBtn.textContent = 'Uploading...';
  uploadBtn.disabled = true;

  try {
    // 1. Send file to backend
    const formData = new FormData();
    formData.append("file", selectedFile);

    // Use environment-aware URL
    const isLocalhost = window.location.hostname === 'localhost' || 
                       window.location.hostname === '127.0.0.1';
    
    const API_URL = isLocalhost
      ? 'http://127.0.0.1:8000/api/predict'
      : 'https://ibcs-6aig.onrender.com/api/predict'; // Replace with your actual deployed backend URL

    console.log('Uploading to:', API_URL);

    const res = await fetch(API_URL, {
      method: "POST",
      body: formData
    });

    if (!res.ok) {
      const errorText = await res.text();
      console.error('Server error:', errorText);
      throw new Error(`Server responded with ${res.status}: ${errorText}`);
    }

    const data = await res.json();
    console.log('Upload successful:', data);

    // 2. Store image + result, then redirect
    const reader = new FileReader();
    reader.onload = function(e) {
      sessionStorage.setItem("uploadedImage", e.target.result);
      sessionStorage.setItem("modelResult", JSON.stringify(data));
      window.location.href = "Website_feedback.html";
    };

    reader.onerror = function() {
      throw new Error("Failed to read image file");
    };

    reader.readAsDataURL(selectedFile);

  } catch (err) {
    console.error("Upload error:", err);
    
    // More specific error messages
    if (err.message.includes("Failed to fetch") || err.message.includes("NetworkError")) {
      alert("Cannot connect to server. Please check:\n1. Backend server is running\n2. Correct URL is configured\n3. No CORS issues");
    } else {
      alert("Upload failed: " + err.message);
    }
    
    // Reset button
    uploadBtn.textContent = originalText;
    uploadBtn.disabled = false;
  }
}
</script>


</body>
</html>